{
    "title": "Parsed Document Schema",
    "description": "A schema for storing structured data extracted from a text document, maintaining original content order through offsets.",
    "type": "object",
    "properties": {
      "introductions": { "...": "..." },
      "chapters": { "...": "..." },
      "end_sections": {
        "description": "An array of concluding sections like 'Index' that appear after the last chapter. The Bibliography is handled separately.",
        "type": "array",
        "items": { "$ref": "#/$defs/contentBlock" }
      },
      "notes": { "...": "..." },
      "linked_notes": { "...": "..." },
      "footnotes": { "...": "..." },
      "bibliography": {
        "description": "A structured representation of the bibliography and its links to in-text citations.",
        "type": "object",
        "properties": {
          "entries": {
            "description": "A map of all parsed bibliography entries, keyed by a unique identifier (e.g., 'author_year').",
            "type": "object",
            "patternProperties": {
              "^[a-z0-9_]+$": { "$ref": "#/$defs/bibliographyEntry" }
            }
          },
          "unlinked_citations": {
            "description": "A list of in-text citations that could not be linked to a bibliography entry, for debugging.",
            "type": "array",
            "items": { "$ref": "#/$defs/inTextCitation" }
          }
        },
        "required": ["entries", "unlinked_citations"]
      }
    },
    "required": ["introductions", "chapters", "end_sections", "notes", "linked_notes", "footnotes", "bibliography"],
    "$defs": {
      "...": "...",
      "bibliographyEntry": {
        "type": "object",
        "properties": {
          "key": {
            "description": "A unique key for the entry, typically 'authorlastname_year'.",
            "type": "string"
          },
          "author": { "type": "string" },
          "year": { "type": "string" },
          "full_text": { "type": "string" },
          "citations": {
            "description": "An array of all in-text citations that link to this entry.",
            "type": "array",
            "items": { "$ref": "#/$defs/inTextCitation" }
          }
        },
        "required": ["key", "author", "year", "full_text", "citations"]
      },
      "inTextCitation": {
        "allOf": [
          { "$ref": "#/$defs/offsetObject" },
          {
            "type": "object",
            "properties": {
              "page_info": {
                "description": "Page numbers or other locators from the citation, if present.",
                "type": ["string", "null"]
              },
              "full_text": {
                "description": "The full text of the citation as it appeared in the document.",
                "type": "string"
              }
            },
            "required": ["page_info", "full_text"]
          }
        ]
      }
    }
  }